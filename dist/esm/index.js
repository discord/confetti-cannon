import*as t from"react";import{v4 as e}from"uuid";function n(t,e){var n=t.x,i=t.y;return n>e.x&&n<e.x+e.width&&i>e.y&&i<e.y+e.height}function i(t,e,n,i){var r=e>0?-1:1,a=Math.abs(e);return.5*t*i*n*a*a*r}var r=function(){function t(t){this.id=t.id,this.position=t.position,this.velocity=t.velocity,this.rotation=t.rotation,this.dragCoefficient=t.dragCoefficient,this.airResistanceArea=t.airResistanceArea,this.size=t.size,this.opacity=t.opacity,this.spriteX=t.spriteX,this.spriteY=t.spriteY,this.spriteWidth=t.spriteWidth,this.spriteHeight=t.spriteHeight,this._lastUpdatedAt=Date.now()}return t.prototype.getNewForces=function(t,e){var n=t.wind*e,r=-t.gravity*e;return{x:n+i(this.dragCoefficient.x,this.velocity.x,this.airResistanceArea.x,t.density),y:r+i(this.dragCoefficient.y,this.velocity.y,this.airResistanceArea.y,t.density)}},t.prototype.update=function(t){var e=Date.now(),n=(e-this._lastUpdatedAt)/100;this.rotation.update(n),this.dragCoefficient.update(n);var i=this.getNewForces(t,n),r=i.x,a=i.y;this.velocity.update(n),this.velocity.x+=r,this.velocity.y+=a,this.position.update(n),this.position.x+=this.velocity.x*n,this.position.y+=this.velocity.y*n,this.size.update(n),this.opacity.update(n),this.opacity.value=Math.max(this.opacity.value,0),this._lastUpdatedAt=e},t.prototype.previewPositionUpdate=function(t,e){var n=e/100,i=this.velocity.previewUpdate(n),r=this.getNewForces(t,n),a=r.x,o=r.y;i.x+=a,i.y+=o;var u=this.position.previewUpdate(n);return u.x+=i.x*n,u.y+=i.y*n,u},t.prototype.draw=function(t,e){e.save(),e.globalAlpha=this.opacity.value,e.setTransform((new DOMMatrix).translateSelf(this.position.x*global.devicePixelRatio,this.position.y*global.devicePixelRatio).rotateSelf(this.rotation.x,this.rotation.y,this.rotation.z)),e.drawImage(t,this.spriteX,this.spriteY,this.spriteWidth,this.spriteHeight,-this.width/2*global.devicePixelRatio,-this.height/2*global.devicePixelRatio,this.width*global.devicePixelRatio,this.height*global.devicePixelRatio),e.restore()},t.prototype.shouldDestroy=function(t,e){return this.opacity.value<0||e.gravity>=0&&this.velocity.y<0&&this.position.y+this.height<0||e.gravity<=0&&this.velocity.y>0&&this.position.y-this.height>t.height||e.wind>=0&&this.velocity.x>0&&this.position.x-this.width>t.width||e.wind<=0&&this.velocity.x<0&&this.position.x+this.width<0},Object.defineProperty(t.prototype,"width",{get:function(){return this.size.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size.y},enumerable:!1,configurable:!0}),t.prototype.addForce=function(t){this.velocity.x+=t.x,this.velocity.y+=t.y},t}(),a={velocity:{type:"static",value:0},rotation:{type:"static",value:0},dragCoefficient:{type:"static",value:1.66},airResistanceArea:{type:"static",value:.001},opacity:{type:"static",value:1}},o=function(t){var e=void 0===t?{}:t,n=e.gravity,i=e.wind,r=e.density;this.gravity=-9.8,this.wind=0,this.density=1.2041,this.gravity=null!=n?n:this.gravity,this.wind=null!=i?i:this.wind,this.density=null!=r?r:this.density},u=function(t,e){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},u(t,e)};function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var s=function(){return s=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},s.apply(this,arguments)};function c(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{l(i.next(t))}catch(t){a(t)}}function u(t){try{l(i.throw(t))}catch(t){a(t)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}l((i=i.apply(t,e||[])).next())}))}function f(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(l){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(o=0)),o;)try{if(n=1,i&&(r=2&u[0]?i.return:u[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,u[1])).done)return r;switch(i=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,i=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){o.label=u[1];break}if(6===u[0]&&o.label<r[1]){o.label=r[1],r=u;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(u);break}r[2]&&o.ops.pop(),o.trys.pop();continue}u=e.call(t,o)}catch(t){u=[6,t],i=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,l])}}}var d=function(t){this.value=t},h=function(){function t(t,e,n){this._x=t,this._y=n?t:e}return t.prototype.update=function(t){this._x.update(t),this._y.update(t)},t.prototype.previewUpdate=function(t){return{x:this._x.previewUpdate(t),y:this._y.previewUpdate(t)}},Object.defineProperty(t.prototype,"x",{get:function(){return this._x.value},set:function(t){this._x.value=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y.value},set:function(t){this._y.value=t},enumerable:!1,configurable:!0}),t}(),p=function(t){function e(e,n,i,r){var a=t.call(this,e,n,r)||this;return a._z=r?e:i,a}return l(e,t),e.prototype.update=function(e){t.prototype.update.call(this,e),this._z.update(e)},e.prototype.previewUpdate=function(e){var n=t.prototype.previewUpdate.call(this,e);return s(s({},n),{z:this._z.previewUpdate(e)})},Object.defineProperty(e.prototype,"z",{get:function(){return this._z.value},set:function(t){this._z.value=t},enumerable:!1,configurable:!0}),e}(h),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.update=function(){},e.prototype.previewUpdate=function(){return this.value},e}(d),y=function(t){function e(e,n){var i=t.call(this,e)||this;return i.addValue=n,i}return l(e,t),e.prototype.update=function(t){this.value=this.previewUpdate(t)},e.prototype.previewUpdate=function(t){return this.value+this.addValue*t},e}(d),m=function(t){function e(e,n,i,r,a,o){var u=t.call(this,e)||this;u.min=n,u.max=i,u.duration=r;var l=u.value/(u.max-u.min)*u.duration,s=isNaN(l)?0:l;return u.timePassed=s<0?u.duration-s:s,u.directionMultiplier=a,u.easingFunction=o,u}return l(e,t),e.prototype.update=function(t){var e=this.doUpdate(t),n=e[0],i=e[1],r=e[2];this.value=n,this.directionMultiplier=r,this.timePassed=i},e.prototype.previewUpdate=function(t){return this.doUpdate(t)[0]},e.prototype.doUpdate=function(t){var e=this.max-this.min,n=this.timePassed+t*this.directionMultiplier,i=Math.min(Math.max(n,0),this.duration),r=n<0||n>this.duration?-1*this.directionMultiplier:this.directionMultiplier,a=this.easingFunction(i,this.min,e,this.duration);return[isNaN(a)?0:a,i,r]},e}(d);function w(t,e){return t===e?t:Math.random()*(e-t+1)+t}function x(t){var e=Math.floor(w(0,t.length-1));return[t[e],e]}function g(t,e){return x([t,e])[0]}function b(t){return"number"==typeof t?{x:t,y:t}:t}function C(t){return"number"==typeof t?{x:t,y:t,z:t}:t}function V(t){return function(t){switch(t.type){case"static":return new v(t.value);case"static-random":return new v(w(t.minValue,t.maxValue));case"linear":return new y(t.value,t.addValue);case"linear-random":return new y(w(t.minValue,t.maxValue),w(t.minAddValue,t.maxAddValue));case"oscillating":return new m(t.value,t.start,t.final,t.duration,t.direction,t.easingFunction);case"oscillating-random":return new m(w(t.minValue,t.maxValue),w(t.minStart,t.maxStart),w(t.minFinal,t.maxFinal),w(t.minDuration,t.maxDuration),g(t.minDirection,t.maxDirection),x(t.easingFunctions)[0])}}(s(s({},t),{valueType:"number"}))}function z(t){return function(t){switch(t.type){case"static":var e=b(t.value);return new h(new v(e.x),new v(e.y),t.uniformVectorValues);case"static-random":var n=b(t.minValue),i=b(t.maxValue);return new h(new v(w(n.x,i.x)),new v(w(n.y,i.y)),t.uniformVectorValues);case"linear":e=b(t.value);var r=b(t.addValue);return new h(new y(e.x,r.x),new y(e.y,r.y),t.uniformVectorValues);case"linear-random":n=b(t.minValue),i=b(t.maxValue);var a=b(t.minAddValue),o=b(t.maxAddValue);return new h(new y(w(n.x,i.x),w(a.x,o.x)),new y(w(n.y,i.y),w(a.x,o.x)),t.uniformVectorValues);case"oscillating":e=b(t.value);var u=b(t.start),l=b(t.final),s=b(t.duration),c=b(t.direction);return new h(new m(e.x,u.x,l.x,s.x,c.x,t.easingFunction),new m(e.y,u.y,l.y,s.x,c.y,t.easingFunction),t.uniformVectorValues);case"oscillating-random":n=b(t.minValue),i=b(t.maxValue);var f=b(t.minStart),d=b(t.maxStart),p=b(t.minFinal),C=b(t.maxFinal),V=b(t.minDuration),z=b(t.maxDuration),R=b(t.minDirection),k=b(t.maxDirection);return new h(new m(w(n.x,i.x),w(f.x,d.x),w(p.x,C.x),w(V.x,z.x),g(R.x,k.x),x(t.easingFunctions)[0]),new m(w(n.y,i.y),w(f.y,d.y),w(p.y,C.y),w(V.y,z.y),g(R.y,k.y),x(t.easingFunctions)[0]),t.uniformVectorValues)}}(s(s({},t),{valueType:"Vector2"}))}function R(t){return function(t){switch(t.type){case"static":var e=C(t.value);return new p(new v(e.x),new v(e.y),new v(e.z),t.uniformVectorValues);case"static-random":var n=C(t.minValue),i=C(t.maxValue);return new p(new v(w(n.x,i.x)),new v(w(n.y,i.y)),new v(w(n.z,i.z)),t.uniformVectorValues);case"linear":e=C(t.value);var r=C(t.addValue);return new p(new y(e.x,r.x),new y(e.y,r.y),new y(e.z,r.z),t.uniformVectorValues);case"linear-random":n=C(t.minValue),i=C(t.maxValue);var a=C(t.minAddValue),o=C(t.maxAddValue);return new p(new y(w(n.x,i.x),w(a.x,o.x)),new y(w(n.y,i.y),w(a.y,o.y)),new y(w(n.z,i.z),w(a.z,o.z)),t.uniformVectorValues);case"oscillating":e=C(t.value);var u=C(t.start),l=C(t.final),s=C(t.duration),c=C(t.direction);return new p(new m(e.x,u.x,l.x,s.x,c.x,t.easingFunction),new m(e.y,u.y,l.y,s.z,c.y,t.easingFunction),new m(e.z,u.z,l.z,s.z,c.z,t.easingFunction),t.uniformVectorValues);case"oscillating-random":n=C(t.minValue),i=C(t.maxValue);var f=C(t.minStart),d=C(t.maxStart),h=C(t.minFinal),b=C(t.maxFinal),V=C(t.minDuration),z=C(t.maxDuration),R=C(t.minDirection),k=C(t.maxDirection);return new p(new m(w(n.x,i.x),w(f.x,d.x),w(h.x,b.x),w(V.x,z.x),g(R.x,k.x),x(t.easingFunctions)[0]),new m(w(n.y,i.y),w(f.y,d.y),w(h.y,b.y),w(V.y,z.y),g(R.y,k.y),x(t.easingFunctions)[0]),new m(w(n.z,i.z),w(f.z,d.z),w(h.z,b.z),w(V.z,z.z),g(R.z,k.z),x(t.easingFunctions)[0]),t.uniformVectorValues)}}(s(s({},t),{valueType:"Vector3"}))}function k(t,e,n,i,o){var u=function(t,e){return s(s({id:e},a),t)}(e,t),l=function(t,e){if(null!=t){var n=e.sprites.findIndex((function(e){return n=e,"string"==typeof(i=t)?n.src===i&&n.colorize:n.src===i.src&&n.colorize===i.colorize;var n,i}));if(-1!==n)return[t,n]}return x(e.sprites)}(i,n),c=l[0],f=l[1],d=function(t,e,n){if(!function(t){return"string"==typeof t||t.colorize}(t))return 0;var i=null!=e?n.colors.findIndex((function(t){return t===e})):-1;return-1!==i?i:Math.floor(w(0,n.colors.length-1))}(null!=i?i:c,o,n);return new r({id:t,position:z(u.position),velocity:z(u.velocity),rotation:R(u.rotation),dragCoefficient:z(u.dragCoefficient),size:z(u.size),opacity:V(u.opacity),airResistanceArea:z(u.airResistanceArea),spriteX:d*n.spriteWidth+2*d,spriteY:f*n.spriteHeight+2*f,spriteWidth:n.spriteWidth,spriteHeight:n.spriteHeight})}var P=t.forwardRef((function(i,r){var a=i.className,o=i.environment,u=i.onClick,l=i.onMouseDown,c=i.onMouseMove,f=i.onMouseUp,d=i.onBeforeRender,h=i.onAfterRender,p=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}(i,["className","environment","onClick","onMouseDown","onMouseMove","onMouseUp","onBeforeRender","onAfterRender"]),v=t.useRef(null),y=t.useRef(new Map),m=t.useRef(null),w=t.useRef(0),x=t.useRef(0),g=t.useCallback((function(){var t=v.current;if(null!=t){var e=t.getContext("2d");if(null!=e){e.clearRect(0,0,t.width,t.height),null==d||d(e),y.current.forEach((function(n,i){var r=n.confetti,a=n.spriteCanvas;r.update(o),r.draw(a,e),r.shouldDestroy(t,o)&&y.current.delete(i)})),null==h||h(e),y.current.size>0?m.current=window.requestAnimationFrame(g):(e.clearRect(0,0,t.width,t.height),m.current=null);var n=Date.now();0!==w.current&&(x.current=1e3/(n-w.current)),w.current=n}}}),[o,h,d]);t.useEffect((function(){null!=m.current&&(window.cancelAnimationFrame(m.current),m.current=window.requestAnimationFrame(g))}),[g]);var b=t.useCallback((function(t,e){y.current.set(t.id,{confetti:t,spriteCanvas:e}),null==m.current&&g()}),[g]),C=t.useCallback((function(t,n,i,r,a){var o,u=k(null!==(o=t.id)&&void 0!==o?o:e(),t,i,r,a);return b(u,n),u}),[b]),V=t.useCallback((function(t){y.current.delete(t)}),[]),z=t.useCallback((function(){return y.current.clear()}),[]),R=t.useCallback((function(){return v.current}),[]);t.useImperativeHandle(r,(function(){return{createConfetti:C,addConfetti:b,deleteConfetti:V,clearConfetti:z,getCanvas:R}}),[C,b,V,z,R]);var P=t.useCallback((function(t,e){var i,r,a=e.clickHandler,u=e.mouseHandler;if(null!=a||null!=u){var l=null===(i=v.current)||void 0===i?void 0:i.getBoundingClientRect();if(null!=l){var s=function(t,e){if(null==e)throw new Error("element should not be null");var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}(t,v.current);if(n(s,{x:l.left,y:l.top,width:l.width,height:l.height})){if(null!=u)return u(t);if(null!=a){var c=-1e3/x.current*2,f=function(t,e){for(var n=0,i=Array.from(t.values());n<i.length;n++){var r=i[n];if(null!=r&&e(r))return r}return null}(y.current,(function(t){var e=t.confetti,i=e.previewPositionUpdate(o,c);return n(s,{x:i.x-e.width/2,y:i.y-e.height/2,width:e.width,height:e.height})}));a(t,null!==(r=null==f?void 0:f.confetti)&&void 0!==r?r:null)}}}}}),[o]),F=t.useCallback((function(t){return P(t,{clickHandler:u})}),[P,u]),M=t.useCallback((function(t){return P(t,{clickHandler:l})}),[P,l]),_=t.useCallback((function(t){return P(t,{mouseHandler:c})}),[P,c]),A=t.useCallback((function(t){return P(t,{mouseHandler:f})}),[P,f]);return t.useEffect((function(){var t=function(t,e,n){null!=n&&window.addEventListener(t,e)};return t("click",F,u),t("mousedown",M,l),t("mousemove",_,c),t("mouseup",A,f),function(){window.removeEventListener("click",F),window.removeEventListener("mousedown",M),window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",_)}}),[F,M,_,A,u,l,c,f]),t.useEffect((function(){var t=v.current,e=new ResizeObserver((function(){!function(t){if(null!=t){var e=t.getBoundingClientRect(),n=e.width,i=e.height;t.width=n*global.devicePixelRatio,t.height=i*global.devicePixelRatio}}(v.current)}));return null!=t&&e.observe(t),function(){null!=t&&e.unobserve(t)}}),[]),t.createElement("canvas",s({},p,{className:a,ref:v}))})),F={display:"none",position:"absolute",width:0,height:0,left:"-100%"},M=t.forwardRef((function(n,i){var r=n.className,a=n.visible,o=void 0!==a&&a,u=n.sprites,l=n.colors,s=n.spriteWidth,d=n.spriteHeight,h=t.useRef(null),p=t.useRef([]),v=t.useRef(!1),y=t.useRef({});t.useImperativeHandle(i,(function(){return{getCanvas:function(){return h.current},getCreateData:function(){return{sprites:p.current,colors:l,spriteWidth:s,spriteHeight:d}},addReadyListener:function(t){var n=e();return y.current[n]=t,n},removeReadyListener:function(t){delete y.current[t]},isReady:v.current}}),[l,d,s]);var m=t.useCallback((function(){var t=h.current,e=null==t?void 0:t.getContext("2d",{willReadFrequently:!0});null!=e&&null!=t&&(e.clearRect(0,0,t.width,t.height),p.current.forEach((function(t,n){var i=function(i,r){var a=s*r+2*r,o=d*n+2*n;if(e.drawImage(t.image,a,o,s,d),null!=i){for(var u=e.getImageData(a,o,s,d),l=function(t){"#"===t[0]&&(t=t.slice(1));var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}}(i),c=0;c<u.data.length;c+=4)u.data[c]=l.r,u.data[c+1]=l.g,u.data[c+2]=l.b;e.putImageData(u,a,o)}};t.colorize?l.forEach((function(t,e){return i(t,e)})):i(null,0)})))}),[l,d,s]),w=t.useCallback((function(){var t=u.map((function(t){var e=new Image,n="string"==typeof t?t:t.src,i="string"==typeof t||t.colorize;e.src=n;var r=new Promise((function(t){e.onload=t}));return{colorize:i,image:e,src:n,loadPromise:r}}));return Promise.all(t.map((function(t){return t.loadPromise}))).then((function(){p.current=t.map((function(t){return{colorize:t.colorize,image:t.image,src:t.src}}))}))}),[u]),x=t.useCallback((function(t){for(var e in y.current)y.current[e](t)}),[]),g=t.useCallback((function(){return c(void 0,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,w()];case 1:return t.sent(),m(),v.current=!0,x(!0),[2]}}))}))}),[x,w,m]);return t.useEffect((function(){g()}),[g]),t.useEffect((function(){return function(){return x(!1)}}),[x]),t.useEffect((function(){null!=h.current&&(h.current.width=(s+2)*Math.max(l.length,1),h.current.height=(d+2)*u.length)}),[l.length,d,s,u.length]),t.createElement("canvas",{ref:h,className:r,style:o?void 0:F})}));function _(e,n){var i,r=t.useState(null!==(i=null==n?void 0:n.isReady)&&void 0!==i&&i),a=r[0],o=r[1];t.useEffect((function(){var t=null==n?void 0:n.addReadyListener(o);return function(){null!=t&&(null==n||n.removeReadyListener(t))}}),[n]);var u=t.useCallback((function(t,i){var r=void 0===i?{}:i,a=r.sprite,o=r.color,u=null==n?void 0:n.getCreateData(),l=null==n?void 0:n.getCanvas();if(null!=l&&null!=u&&0!==u.sprites.length)return null==e?void 0:e.createConfetti(t,l,u,a,o)}),[e,n]),l=t.useCallback((function(t,e,n){for(var i=[],r=0;r<e;r++){var a=u(t,n);a&&i.push(a)}return i}),[u]),s=t.useCallback((function(t){var i=null==n?void 0:n.getCanvas();null!=i&&(null==e||e.addConfetti(t,i))}),[e,n]),c=t.useCallback((function(t){null==e||e.deleteConfetti(t)}),[e]),f=t.useCallback((function(){return null==e?void 0:e.clearConfetti()}),[e]);return t.useMemo((function(){return{createConfetti:u,createMultipleConfetti:l,addConfetti:s,clearConfetti:f,deleteConfetti:c,isReady:a&&null!=n&&null!=e}}),[s,f,e,u,l,c,a,n])}var A=function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e};export{a as CREATE_CONFETTI_DEFAULTS,r as Confetti,P as ConfettiCanvas,o as Environment,y as LinearUpdatableValue,m as OscillatingUpdatableValue,M as SpriteCanvas,v as StaticUpdatableValue,k as createConfetti,A as easeInOutQuad,V as getUpdatableValueNumber,z as getUpdatableValueVector2,R as getUpdatableValueVector3,_ as useConfettiCannon};
//# sourceMappingURL=index.js.map
